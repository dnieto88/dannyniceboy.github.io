angular.module("mongolabResourceHttp",[]).factory("$mongolabResourceHttp",["MONGOLAB_CONFIG","$http","$q",function(e,t,a){function n(n){var r=angular.extend({BASE_URL:"https://api.mongolab.com/api/1/databases/"},e),o=r.BASE_URL+r.DB_NAME,i=o+"/collections/"+n,l={apiKey:r.API_KEY},c=function(e){return new m(e)},s=function(e){for(var t=[],a=0;a<e.length;a++)t.push(new m(e[a]));return t},u=function(e,t,n,r){return e.then(function(e){var a=r(e.data);return(t||angular.noop)(a,e.status,e.headers,e.config),a},function(e){return(n||angular.noop)(void 0,e.status,e.headers,e.config),a.reject(e.data)})},d=function(e){return angular.isObject(e)&&!angular.equals(e,{})?{q:JSON.stringify(e)}:{}},m=function(e){angular.extend(this,e)};return m.query=function(e,a,n,r){var o=function(e){var t={sort:"s",limit:"l",fields:"f",skip:"sk"},a={};return e&&!angular.equals(e,{})&&angular.forEach(t,function(t,n){angular.isDefined(e[n])&&(a[t]=angular.isObject(e[n])?JSON.stringify(e[n]):e[n])}),a};angular.isFunction(a)&&(r=n,n=a,a={});var c=angular.extend({},l,d(e),o(a)),m=t.get(i,{params:c});return u(m,n,r,s)},m.all=function(e,t,a){return angular.isFunction(e)&&(a=t,t=e,e={}),m.query({},e,t,a)},m.count=function(e,a,n){var r=t.get(i,{params:angular.extend({},l,d(e),{c:!0})});return u(r,a,n,function(e){return e})},m.distinct=function(e,a,r,i){var c=t.post(o+"/runCommand",angular.extend({},a||{},{distinct:n,key:e}),{params:l});return u(c,r,i,function(e){return e.values})},m.getById=function(e,a,n){var r=t.get(i+"/"+e,{params:l});return u(r,a,n,c)},m.getByObjectIds=function(e,t,a){var n=[];return angular.forEach(e,function(e){n.push({$oid:e})}),m.query({_id:{$in:n}},t,a)},m.prototype.$id=function(){return this._id&&this._id.$oid?this._id.$oid:this._id?this._id:void 0},m.prototype.$save=function(e,a){var n=t.post(i,this,{params:l});return u(n,e,a,c)},m.prototype.$update=function(e,a){var n=t.put(i+"/"+this.$id(),angular.extend({},this,{_id:void 0}),{params:l});return u(n,e,a,c)},m.prototype.$remove=function(e,a){var n=t["delete"](i+"/"+this.$id(),{params:l});return u(n,e,a,c)},m.prototype.$saveOrUpdate=function(e,t,a,n){return this.$id()?this.$update(t,n):this.$save(e,a)},m}return n}]),function(e){try{e=angular.module("cws-tailgate-templates")}catch(t){e=angular.module("cws-tailgate-templates",[])}e.run(["$templateCache",function(e){e.put("/cws-tailgate/map/map.html",'<div class="begin" ng-hide="mapctrl.selectedTeam"><div class="row"><div class="small-12 columns"><div class="panel"><p>Select A Team To Begin</p></div></div></div></div><div class="row"><div class="small-12 columns"><select ng-model="mapctrl.selectedTeam" ng-options="t as t for t in mapctrl.teams" ng-change="getTailGates()"><option value="">-- Select a Team--</option></select></div></div><div ng-if="mapctrl.selectedTeam"><div class="row"><google-map center="map.center" zoom="map.zoom" draggable="true" pan="true"><marker coords="currentLocationMarker.coords"><marker-label content="&quot;You are Here&quot;" anchor="0 0" class="tailgate-label"></marker-label></marker><marker coords="cwsMarker.coords" icon="cwsMarker.icon"><marker-label content="cwsMarker.label" anchor="0 0" class="tailgate-label"></marker-label></marker><marker coords="busMarker.coords" icon="busMarker.icon"><marker-label content="busMarker.label" anchor="0 0" class="bus-label"></marker-label></marker><markers models="mapctrl.tailgates" coords="\'coords\'" labelcontent="\'name\'" labelanchor="0 0" labelclass="tailgate-label" icon="\'icon\'" click="showDetails(m)"></markers></google-map></div><div class="row"><div class="small-12 medium-6 columns end"><div class="panel primary add-team-form"><h2>Add Tail Gate</h2><form ng-model="newtailGate"><div class="row"><label>Name:<input type="text" ng-model="newTailGate.name"></label></div><div class="row"><label>Team:<input type="text" ng-model="newTailGate.team"></label></div><div class="row"><label><input type="checkbox" ng-model="mapctrl.useCurrentLocation">Use Current Location</label></div><div class="row"><button class="button expand" ng-click="add(newTailGate)">Add tailgate</button></div></form></div></div></div></div>')}])}(),angular.module("cwsTailgate.map.service",["mongolabResourceHttp"]).constant("MONGOLAB_CONFIG",{API_KEY:"rQxsZ4OjiJ_6cxUf40Heixvdm8oZg0dT",DB_NAME:"cws-tail-gating"}).factory("cwsMapPoints",["$mongolabResourceHttp","$window","$q",function(e,t,a){var n=e("tailgates"),r=function(e){var e=e||"";return n.query({team:e})},o=function(e){e.useCurrentLocation&&delete e.useCurrentLocation;var t=new n(e);return t.$saveOrUpdate()},i=function(){return n.distinct("team")},l=function(){var e=a.defer();return angular.isDefined(t.navigator.geolocation)?t.navigator.geolocation.getCurrentPosition(function(t){console.log("Got location -> ",t),e.resolve(t)},function(t){e.reject(t)}):(console.log("No geolocation"),e.reject("No geolocation available")),e.promise};return{get:r,getAllTeams:i,add:o,currentLocation:l}}]),angular.module("cwsTailgate.map.controller",["cwsTailgate.map.service","google-maps"]).controller("MapCtrl",["$scope","cwsMapPoints","$log",function(e,t){"use strict";e.map={center:{latitude:"41.1757071",longitude:"-96.01572449999999"},zoom:14},e.mapctrl={tailgates:[],currentLocation:{},useCurrentLocation:!0,teams:[],selectedTeam:""},e.newTailGate={team:""},e.getTeams=function(){t.getAllTeams().then(function(t){e.mapctrl.teams=t},function(e){console.log(e)})},e.getTailGates=function(){e.newTailGate.team=e.mapctrl.selectedTeam,t.get(e.mapctrl.selectedTeam).then(function(t){for(var a=0;a<t.length;a++)t[a].id=a,t[a].icon||(t[a].icon="assets/beer.png");e.mapctrl.tailgates=t},function(e){console.log(e)})},e.getCurrentLocation=function(){t.currentLocation().then(function(t){e.mapctrl.currentLocation=t,e.currentLocationMarker=t,e.map.center=t.coords},function(t){e.map.center=e.busMarker.coords,console.log(t)})},e.add=function(a){e.mapctrl.useCurrentLocation&&(a.coords=e.mapctrl.currentLocation.coords,a.time=e.mapctrl.currentLocation.timestamp),t.add(a).then(function(){e.newTailGate={team:e.mapctrl.selectedTeam}},function(e){console.log(e)}).then(e.getTailGates())},e.cwsMarker={coords:{latitude:"41.2670",longitude:"-95.9320"},label:"CWS",position:"0 0",icon:"assets/star.png"},e.busMarker={coords:{latitude:"41.280636",longitude:"-95.912817"},label:"ULTRA MEGA PARTY BUS 1988-?",position:"0 0",icon:"assets/bus.png"},e.currentLocationMarker={coords:{}},e.getCurrentLocation(),e.getTeams()}]),angular.module("cwsTailgate.map",["cwsTailgate.map.controller","cwsTailgate.map.service"]),angular.module("cwsTailgate",["ngRoute","cwsTailgate.map","cws-tailgate-templates","mongolabResourceHttp","mm.foundation"]).config(["$routeProvider",function(e){"use strict";e.when("/map",{controller:"MapCtrl",templateUrl:"/cws-tailgate/map/map.html"}).otherwise({redirectTo:"/map"})}]);